<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/android-chrome-192x192.png">
    <link rel="stylesheet" href="css/style.css">
    <title>Paper Calculator</title>
</head>

<body>
    <div id="appNutrition">
        <button @click="isOpened=!isOpened" class="title-button" :class="{ '_state-open': isOpened }">栄養</button>
        <div v-show="isOpened">
            <p>値段<input type="number" v-model.number="price" min="1"></p>
            <p>内容量<input type="number" v-model.number="total" min="1"></p>
            <p>容量(成分表示)<input type="number" v-model.number="seibun" min="1"></p>
            <p>栄養(成分表示)<input type="number" v-model.number="nutrition" min="1"></p>
            <p>1gあたりの値段(数字が小さいほどお得)</p>
            <p><button @click="addRow" class="small-button">+</button>{{ result }}円/g</p>
            <table>
                <thead>
                    <tr>
                        <th @click="sortBy('CP')" :class="sortedClass('CP')">円/g</th>
                        <th @click="sortBy('Price')" :class="sortedClass('Price')">値段</th>
                        <th @click="sortBy('Total')" :class="sortedClass('Total')">内容量</th>
                        <th @click="sortBy('Seibun')" :class="sortedClass('Seibun')">容量</th>
                        <th @click="sortBy('Nutrition')" :class="sortedClass('Nutrition')">栄養</th>
                        <th>削除</th>
                    </tr>
                </thead>

                <tbody>
                    <tr v-for="row in eventedAction">
                        <td>{{row.CP}}</td>
                        <td>{{row.Price}}</td>
                        <td>{{row.Total}}</td>
                        <td>{{row.Seibun}}</td>
                        <td>{{row.Nutrition}}</td>
                        <td><button @click="delRow(row)" class="small-button">-</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="appTissue">
        <button @click="isOpened=!isOpened" class="title-button" :class="{ '_state-open': isOpened }">ティッシュボックス</button>
        <div v-show="isOpened">
            <p>値段<input type="number" v-model.number="price" min="1"></p>
            <p>箱数<input type="number" v-model.number="boxes" min="1"></p>
            <p>組数<input type="number" v-model.number="pairs" min="1"></p>
            <p>1円あたりの組数(数字が大きいほどお得)</p>
            <p><button @click="addRow" class="small-button">+</button>{{ result }}組/円</p>
            <table>
                <thead>
                    <tr>
                        <th @click="sortBy('CP')" :class="sortedClass('CP')">組/円</th>
                        <th @click="sortBy('Price')" :class="sortedClass('Price')">値段</th>
                        <th @click="sortBy('Boxes')" :class="sortedClass('Boxes')">箱数</th>
                        <th @click="sortBy('Pairs')" :class="sortedClass('Pairs')">組数</th>
                        <th>削除</th>
                    </tr>
                </thead>

                <tbody>
                    <tr v-for="row in eventedAction">
                        <td>{{row.CP}}</td>
                        <td>{{row.Price}}</td>
                        <td>{{row.Boxes}}</td>
                        <td>{{row.Pairs}}</td>
                        <td><button @click="delRow(row)" class="small-button">-</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="appToipe">
        <button @click="isOpened=!isOpened" class="title-button" :class="{ '_state-open': isOpened }">トイレットペーパー</button>
        <div v-show="isOpened">
            <p>値段<input type="number" v-model.number="price" min="1"></p>
            <p>巻数<input type="number" v-model.number="rolls" min="1"></p>
            <p>メートル<input type="number" v-model.number="meters" min="1"></p>
            <input type="radio" id="single" value="シングル" v-model="picked">
            <label for="single">シングル</label>
            <input type="radio" id="double" value="ダブル" v-model="picked">
            <label for="double">ダブル</label>
            <p>1円あたりの長さ(数字が大きいほどお得)</p>
            <p><button @click="addRow" class="small-button">+</button>{{ result }}m/円</p>
            <table>
                <thead>
                    <tr>
                        <th @click="sortBy('CP')" :class="sortedClass('CP')">組/円</th>
                        <th @click="sortBy('Price')" :class="sortedClass('Price')">値段</th>
                        <th @click="sortBy('Rolls')" :class="sortedClass('Rolls')">巻数</th>
                        <th @click="sortBy('Meters')" :class="sortedClass('Meters')">m</th>
                        <th @click="sortBy('SD')" :class="sortedClass('SD')">S/D</th>
                        <th>削除</th>
                    </tr>
                </thead>

                <tbody>
                    <tr v-for="row in eventedAction">
                        <td>{{row.CP}}</td>
                        <td>{{row.Price}}</td>
                        <td>{{row.Rolls}}</td>
                        <td>{{row.Meters}}</td>
                        <td>{{row.SD}}</td>
                        <td><button @click="delRow(row)" class="small-button">-</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service_worker.js').then(function(registration) {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }).catch(function(err) {
                console.log('ServiceWorker registration failed: ', err);
            });
        }

        var appNutrition = new Vue({
            el: '#appNutrition',
            computed: {
                result: function() {
                    var cp = this.price / (this.total / this.seibun * this.nutrition);
                    if (isNaN(cp) || !isFinite(cp)) {
                        return 0;
                    } else {
                        return roundDigit(cp, 2);
                    }
                },
                eventedAction: function() {
                    let list = this.items.slice();
                    // ソート実施
                    if (this.sort.key) {
                        list.sort((a, b) => {
                            a = a[this.sort.key];
                            b = b[this.sort.key];
                            return (a === b ? 0 : a > b ? 1 : -1) * (this.sort.isAsc ? 1 : -1);
                        });
                    }
                    return list;
                }
            },
            methods: {
                // sort用キーをセットし、昇順・降順を入れ替える
                sortBy: function(key) {
                    this.sort.isAsc = this.sort.key === key ? !this.sort.isAsc : false;
                    this.sort.key = key;
                },
                sortedClass: function(key) {
                    return this.sort.key === key ? `sorted ${this.sort.isAsc ? 'asc' : 'desc'}` : '';
                },
                addRow: function() {
                    this.items.push({
                        'CP': this.result,
                        'Price': this.price,
                        'Total': this.total,
                        'Seibun': this.seibun,
                        'Nutrition': this.nutrition
                    });
                },
                delRow: function(row) {
                    var index = this.items.indexOf(row);
                    this.items.splice(index, 1);
                }
            },
            data: {
                isOpened: false,
                price: 4000,
                total: 1000,
                seibun: 20,
                nutrition: 15,
                items: items = [],
                sort: {
                    key: 'CP', // ソートキー
                    isAsc: true // 昇順ならtrue,降順ならfalse
                }
            }
        });

        var appTissue = new Vue({
            el: '#appTissue',
            computed: {
                result: function() {
                    var cp = this.boxes * this.pairs / this.price;
                    if (isNaN(cp) || !isFinite(cp)) {
                        return 0;
                    } else {
                        return roundDigit(cp, 2);
                    }
                },
                eventedAction: function() {
                    let list = this.items.slice();
                    // ソート実施
                    if (this.sort.key) {
                        list.sort((a, b) => {
                            a = a[this.sort.key];
                            b = b[this.sort.key];
                            return (a === b ? 0 : a > b ? 1 : -1) * (this.sort.isAsc ? 1 : -1);
                        });
                    }
                    return list;
                }
            },
            methods: {
                // sort用キーをセットし、昇順・降順を入れ替える
                sortBy: function(key) {
                    this.sort.isAsc = this.sort.key === key ? !this.sort.isAsc : false;
                    this.sort.key = key;
                },
                sortedClass: function(key) {
                    return this.sort.key === key ? `sorted ${this.sort.isAsc ? 'asc' : 'desc'}` : '';
                },
                addRow: function() {
                    this.items.push({
                        'CP': this.result,
                        'Price': this.price,
                        'Boxes': this.boxes,
                        'Pairs': this.pairs
                    });
                },
                delRow: function(row) {
                    var index = this.items.indexOf(row);
                    this.items.splice(index, 1);
                }
            },
            data: {
                isOpened: false,
                price: 300,
                boxes: 5,
                pairs: 150,
                items: items = [],
                sort: {
                    key: 'CP', // ソートキー
                    isAsc: false // 昇順ならtrue,降順ならfalse
                }
            }
        });

        var appToipe = new Vue({
            el: '#appToipe',
            computed: {
                result: function() {
                    var cp = this.rolls * this.meters / this.price;
                    if (this.picked == 'ダブル') {
                        cp = cp * 2;
                    }
                    if (isNaN(cp) || !isFinite(cp)) {
                        return 0;
                    } else {
                        return roundDigit(cp, 2);
                    }
                },
                eventedAction: function() {
                    let list = this.items.slice();
                    // ソート実施
                    if (this.sort.key) {
                        list.sort((a, b) => {
                            a = a[this.sort.key];
                            b = b[this.sort.key];
                            return (a === b ? 0 : a > b ? 1 : -1) * (this.sort.isAsc ? 1 : -1);
                        });
                    }
                    return list;
                }
            },
            methods: {
                // sort用キーをセットし、昇順・降順を入れ替える
                sortBy: function(key) {
                    this.sort.isAsc = this.sort.key === key ? !this.sort.isAsc : false;
                    this.sort.key = key;
                },
                sortedClass: function(key) {
                    return this.sort.key === key ? `sorted ${this.sort.isAsc ? 'asc' : 'desc'}` : '';
                },
                addRow: function() {
                    this.items.push({
                        'CP': this.result,
                        'Price': this.price,
                        'Rolls': this.rolls,
                        'Meters': this.meters,
                        'SD': this.picked
                    });
                },
                delRow: function(row) {
                    var index = this.items.indexOf(row);
                    this.items.splice(index, 1);
                }
            },
            data: {
                isOpened: false,
                price: 500,
                rolls: 12,
                meters: 25,
                picked: 'ダブル',
                items: items = [],
                sort: {
                    key: 'CP', // ソートキー
                    isAsc: false // 昇順ならtrue,降順ならfalse
                }
            }
        });

        /**
         * 任意の桁で四捨五入する関数
         * @param {number} value 四捨五入する数値
         * @param {number} digit どの桁で四捨五入するか（1→小数点第1位, 2→小数点第2位, ...）
         * @return {number} 四捨五入した値
         */
        function roundDigit(value, digit) {
            return Math.round(value * Math.pow(10, digit)) / Math.pow(10, digit);
        }
    </script>
</body>

</html>